<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Squarified Example</title>
    <style>
    #app, html, body {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
    }
    p {
      margin: 0;
      padding: 0;
    }
    </style>
  </head>
  <body>
    <div id="app"></div>
    
<script>"use strict";(()=>{var Ct=Math.PI/180,oe=Math.PI*2,k={a:1,b:0,c:0,d:1,e:0,f:0},W=class{a;b;c;d;e;f;constructor(t={}){this.a=t.a||1,this.b=t.b||0,this.c=t.c||0,this.d=t.d||1,this.e=t.e||0,this.f=t.f||0}create(t){return Object.assign(this,t),this}transform(t,n,i,o,r,a,s){return this.scale(i,o).translation(t,n),a||s?this.skew(a,s):this.roate(r),this}translation(t,n){return this.e+=t,this.f+=n,this}scale(t,n){return this.a*=t,this.d*=n,this}skew(t,n){let i=Math.tan(t*Ct),o=Math.tan(n*Ct),r=this.a+this.b*i,a=this.b+this.a*o,s=this.c+this.d*i,l=this.d+this.c*o;return this.a=r,this.b=a,this.c=s,this.d=l,this}roate(t){if(t>0){let n=t*Ct,i=Math.cos(n),o=Math.sin(n),r=this.a*i-this.b*o,a=this.a*o+this.b*i,s=this.c*i-this.d*o,l=this.c*o+this.d*i;this.a=r,this.b=a,this.c=s,this.d=l}return this}};var we={id:0,get(){return this.id++}};var ot=class{parent;id;matrix;constructor(){this.parent=null,this.id=we.get(),this.matrix=new W}destory(){}},D={fillStyle:1,strokeStyle:2,font:4,lineWidth:8,textAlign:16,textBaseline:32},Pe=D.fillStyle|D.strokeStyle|D.font|D.lineWidth|D.textAlign|D.textBaseline,A=0;function Ae(){return{mods:[],fillStyle(...e){this.mods.push({mod:["fillStyle",e],type:D.fillStyle})},fillRect(...e){this.mods.push({mod:["fillRect",e],type:A})},strokeStyle(...e){this.mods.push({mod:["strokeStyle",e],type:D.strokeStyle})},lineWidth(...e){this.mods.push({mod:["lineWidth",e],type:D.lineWidth})},strokeRect(...e){this.mods.push({mod:["strokeRect",e],type:A})},fillText(...e){this.mods.push({mod:["fillText",e],type:A})},font(...e){this.mods.push({mod:["font",e],type:D.font})},textBaseline(...e){this.mods.push({mod:["textBaseline",e],type:D.textBaseline})},textAlign(...e){this.mods.push({mod:["textAlign",e],type:D.textAlign})},beginPath(){this.mods.push({mod:["beginPath",[]],type:A})},moveTo(...e){this.mods.push({mod:["moveTo",e],type:A})},arcTo(...e){this.mods.push({mod:["arcTo",e],type:A})},closePath(){this.mods.push({mod:["closePath",[]],type:A})},fill(){this.mods.push({mod:["fill",[]],type:A})},stroke(){this.mods.push({mod:["stroke",[]],type:A})},drawImage(...e){this.mods.push({mod:["drawImage",e],type:A})}}}var Rt=class extends ot{width;height;x;y;scaleX;scaleY;rotation;skewX;skewY;constructor(t={}){super(),this.width=t.width||0,this.height=t.height||0,this.x=t.x||0,this.y=t.y||0,this.scaleX=t.scaleX||1,this.scaleY=t.scaleY||1,this.rotation=t.rotation||0,this.skewX=t.skewX||0,this.skewY=t.skewY||0}},V=class extends Rt{instruction;__options__;constructor(t={}){super(t),this.instruction=Ae(),this.__options__=t}render(t){this.create();let n=this.instruction.mods.length;for(let i=0;i<n;i++){let{mod:o,type:r}=this.instruction.mods[i],[a,...s]=o;if(r&Pe){t[a]=s[0];continue}t[a].apply(t,...s)}}get __instanceOf__(){return"Graph"}};function Pt(e){return e.__instanceOf__==="Graph"}function Ie(e){return e.__instanceOf__==="Box"}function Le(e){return Pt(e)&&e.__shape__==="RoundRect"}function Se(e){return Pt(e)&&e.__shape__==="Text"}var S={isGraph:Pt,isBox:Ie,isText:Se,isRoundRect:Le};var At=class extends ot{elements;constructor(){super(),this.elements=[]}add(...t){let n=t.length;for(let i=0;i<n;i++){let o=t[i];o.parent,this.elements.push(o),o.parent=this}}remove(...t){let n=t.length;for(let i=0;i<n;i++)for(let o=this.elements.length-1;o>=0;o--){let r=this.elements[o];r.id===t[i].id&&(this.elements.splice(o,1),r.parent=null)}}destory(){this.elements.forEach(t=>t.parent=null),this.elements.length=0}},B=class e extends At{elements;constructor(){super(),this.elements=[]}add(...t){let n=t.length;for(let i=0;i<n;i++){let o=t[i];o.parent,this.elements.push(o),o.parent=this}}remove(...t){let n=t.length;for(let i=0;i<n;i++)for(let o=this.elements.length-1;o>=0;o--){let r=this.elements[o];r.id===t[i].id&&(this.elements.splice(o,1),r.parent=null)}}destory(){this.elements.forEach(t=>t.parent=null),this.elements.length=0}get __instanceOf__(){return"Box"}clone(){let t=new e;if(this.elements.length){let n=[{elements:this.elements,parent:t}];for(;n.length>0;){let{elements:i,parent:o}=n.pop(),r=i.length;for(let a=0;a<r;a++){let s=i[a];if(S.isBox(s)){let l=new e;l.parent=o,o.add(l),n.push({elements:s.elements,parent:l})}else if(S.isGraph(s)){let l=s.clone();l.parent=o,o.add(l)}}}}return t}};function Ne(e){let{h:t,l:n,s:i,a:o}=e;return"a"in e?`hsla(${t}deg, ${i}%, ${n}%, ${o})`:`hsl(${t}deg, ${i}%, ${n}%)`}function ke(e){let{r:t,g:n,b:i,a:o}=e;return"a"in e?`rgba(${t}, ${n}, ${i}, ${o})`:`rgb(${t}, ${n}, ${i})`}function Be(e){return e.mode==="rgb"?ke(e.desc):Ne(e.desc)}function Ge(e,t=1){let n={mode:e.mode,desc:{...e.desc,a:t}};return Be(n)}var re={evaluateFillStyle:Ge};var rt=class e extends V{style;constructor(t={}){super(t),this.style=t.style||Object.create(null)}get __shape__(){return"RoundRect"}create(){let t=this.style.padding,n=0,i=0,o=this.width-t*2,r=this.height-t*2,a=this.style.radius||0;this.instruction.beginPath(),this.instruction.moveTo(n+a,i),this.instruction.arcTo(n+o,i,n+o,i+r,a),this.instruction.arcTo(n+o,i+r,n,i+r,a),this.instruction.arcTo(n,i+r,n,i,a),this.instruction.arcTo(n,i,n+o,i,a),this.instruction.closePath(),this.style.fill&&(this.instruction.closePath(),this.instruction.fillStyle(re.evaluateFillStyle(this.style.fill,this.style.opacity)),this.instruction.fill()),this.style.stroke&&(typeof this.style.lineWidth=="number"&&this.instruction.lineWidth(this.style.lineWidth),this.instruction.strokeStyle(this.style.stroke),this.instruction.stroke())}clone(){return new e({...this.style,...this.__options__})}};var st=class e extends V{text;style;constructor(t={}){super(t),this.text=t.text||"",this.style=t.style||Object.create(null)}create(){this.style.fill&&(this.instruction.font(this.style.font),this.instruction.lineWidth(this.style.lineWidth),this.instruction.textBaseline(this.style.baseline),this.instruction.textAlign(this.style.textAlign),this.instruction.fillStyle(this.style.fill),this.instruction.fillText(this.text,0,0))}clone(){return new e({...this.style,...this.__options__})}get __shape__(){return"Text"}};function It(e,t){let n=e.length;for(let i=0;i<n;i++){let o=e[i];S.isGraph(o)?t(o):S.isBox(o)&&It(o.elements,t)}}var se={linear:e=>e,quadraticIn:e=>e*e,quadraticOut:e=>e*(2-e),quadraticInOut:e=>(e*=2)<1?.5*e*e:-.5*(--e*(e-2)-1),cubicIn:e=>e*e*e,cubicOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2),cubicInOut:e=>(e*=2)<1?.5*e*e*e:.5*((e-=2)*e*e+2)};var G=class{eventCollections;constructor(){this.eventCollections=Object.create(null)}on(t,n,i){t in this.eventCollections||(this.eventCollections[t]=[]);let o={name:t,handler:n,ctx:i||this,silent:!1};this.eventCollections[t].push(o)}off(t,n){if(t in this.eventCollections){if(!n){this.eventCollections[t]=[];return}this.eventCollections[t]=this.eventCollections[t].filter(i=>i.handler!==n)}}silent(t,n){t in this.eventCollections&&this.eventCollections[t].forEach(i=>{(!n||i.handler===n)&&(i.silent=!0)})}active(t,n){t in this.eventCollections&&this.eventCollections[t].forEach(i=>{(!n||i.handler===n)&&(i.silent=!1)})}emit(t,...n){if(!this.eventCollections[t])return;let i=this.eventCollections[t];i.length&&i.forEach(o=>{o.silent||o.handler.call(o.ctx,...n)})}bindWithContext(t){return(n,i)=>this.on(n,i,t)}};function _e(e){let t=0,n=0;if(document.documentElement.getBoundingClientRect&&e.getBoundingClientRect){let{top:i,left:o}=e.getBoundingClientRect();t=i,n=o}else for(let i=e;i;i=e.offsetParent)t+=e.offsetLeft,n+=e.offsetTop;return[t+Math.max(document.documentElement.scrollLeft,document.body.scrollLeft),n+Math.max(document.documentElement.scrollTop,document.body.scrollTop)]}function ae(e,t,n,i,o,r){let a=e.getBoundingClientRect();if(t instanceof MouseEvent){let[s,l]=_e(e);return{x:(t.clientX-a.left-s-o)/n,y:(t.clientY-a.top-l-r)/i}}return{x:0,y:0}}function He(e){return t=>{let n=()=>{t()||(e.animationFrameID=Lt(n))};e.animationFrameID||(e.animationFrameID=Lt(n))}}function Fe(e){return()=>{e.animationFrameID&&(window.cancelAnimationFrame(e.animationFrameID),e.animationFrameID=null)}}function le(){let e={animationFrameID:null},t=He(e),n=Fe(e);return{run:t,stop:n}}function at(e){let t=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);t=(t<<5)-t+i,t=t&t}return t}function St(e){return typeof e=="number"?!0:e.charCodeAt(0)>=48&&e.charCodeAt(0)<=57}function dt(e,t,n,i,o){return new rt({width:n,height:i,x:e,y:t,style:{...o}})}function ce(e,t,n,i,o){return new st({text:e,x:t,y:n,style:{fill:o,textAlign:"center",baseline:"middle",font:i,lineWidth:1}})}var Lt=window.requestAnimationFrame;function ue(){return document.createElement("canvas")}function Nt(e,t,n){e.setTransform(t.a*n,t.b*n,t.c*n,t.d*n,t.e*n,t.f*n)}function pt(e,t){return t.forEach(({name:n,fn:i})=>{Object.defineProperty(e,n,{value:i(e),writable:!1,enumerable:!0})}),e}function kt(e,t,n,i){e.x=e.x*i+t,e.y=e.y*i+n,e.scaleX=i,e.scaleY=i}function K(e,t,n,i){It(e,o=>kt(o,t,n,i))}function _(e,t){let n=le(),i=Date.now(),o=r=>Array.isArray(t.deps)?t.deps.some(a=>a()):r>=1;n.run(()=>{let r=Date.now()-i,a=Math.min(r/t.duration,1);return o(a)?(n.stop(),t.onStop&&t.onStop(),!0):e(a,n.stop)})}function he(e){return e.which===2||e.which===3}var ht=class extends Map{defaultFactory;constructor(t,n){super(n),this.defaultFactory=t}get(t){return super.has(t)?super.get(t):this.defaultFactory()}getOrInsert(t,n){if(!super.has(t)){let i=n||this.defaultFactory();return super.set(t,i),i}return super.get(t)}};var mt=e=>({error:t=>console.error(`[${e}] ${t}`),panic:t=>{throw new Error(`[${e}] ${t}`)}});function de(e,t,n){e==null&&t.panic(n)}var Xe="etoile",pe=mt(Xe);function qe(e,t,n,i){e.width=t*i,e.height=n*i,e.style.cssText=`width: ${t}px; height: ${n}px`}var Bt=class{canvas;ctx;constructor(t){this.canvas=ue(),this.setOptions(t),this.ctx=this.canvas.getContext("2d")}setOptions(t){qe(this.canvas,t.width,t.height,t.devicePixelRatio)}},ft=class{options;container;constructor(t,n){this.container=new Bt(n),this.options=n,this.initOptions(n),n.shaow||t.appendChild(this.container.canvas)}clear(t,n){this.ctx.clearRect(0,0,t,n)}get canvas(){return this.container.canvas}get ctx(){return this.container.ctx}initOptions(t={}){Object.assign(this.options,t),this.container.setOptions(this.options)}destory(){}};function me(e,t){let{ctx:n,dpr:i}=t;if(n.save(),S.isBox(e)){let o=e.elements,r=o.length;for(let a=0;a<r;a++){let s=o[a];me(s,t)}}if(S.isGraph(e)){let o=e.matrix.create({a:1,b:0,c:0,d:1,e:0,f:0});o.transform(e.x,e.y,e.scaleX,e.scaleY,e.rotation,e.skewX,e.skewY),Nt(n,o,i),e.render(n)}n.restore()}var $=class extends B{render;to;event;constructor(t,n={}){super(),this.to=typeof t=="string"?document.querySelector(t):t,this.to||pe.panic("The element to bind is not found.");let{width:i,height:o}=this.to.getBoundingClientRect();Object.assign(n,{width:i,height:o},{devicePixelRatio:window.devicePixelRatio||1}),this.event=new G,this.render=new ft(this.to,n)}update(){this.render.clear(this.render.options.width,this.render.options.height),this.execute(this.render,this);let t=this.matrix.create({a:1,b:0,c:0,d:1,e:0,f:0});Nt(this.render.ctx,t,this.render.options.devicePixelRatio)}execute(t,n=this){me(n,{c:t.canvas,ctx:t.ctx,dpr:t.options.devicePixelRatio})}};function gt(e,...t){return e.sort((n,i)=>{for(let o of t){let r=n[o],a=i[o];if(St(r)&&St(a)){if(a>r)return 1;if(a<r)return-1;continue}let s=(""+r).localeCompare(""+a);if(s!==0)return s}return 0})}function yt(e,t,n){Array.isArray(e.groups)&&(e.groups=gt(e.groups.map(o=>yt(o,t,n)),"weight"));let i={...e,weight:e[t]};return n&&Object.assign(i,n(i)),i}function Gt(e,t){return e.map(n=>{let i={...n};return i.parent=t,i.groups&&Array.isArray(i.groups)&&(i.groups=Gt(i.groups,i)),i})}function _t(e){let t=0;for(;e.parent;)e=e.parent,t++;return t}function xt(e,t){if(!e)return null;for(let n of e){if(n.children){let o=xt(n.children,t);if(o)return o}if(t(n))return n}return null}function Ht(e,t){return xt(t,n=>{let[i,o,r,a]=n.layout;if(e.x>=i&&e.y>=o&&e.x<i+r&&e.y<o+a)return!0})}function Ft(e,t){return xt(t,n=>{if(n.node.id===e)return!0})}function Ye(e,t){let n=t.map(i=>i.id).sort().join("-");return Math.abs(at(n))+"-"+e}function ze(e,t,n,i){if(!e||!e.length)return[];let o=e.reduce((s,l)=>s+l.weight,0);if(o<=0)return[];let r=[],a=[];if(e.forEach(s=>{let l=s.weight/o*t;Math.sqrt(l)<n||l<i?a.push({...s}):r.push({...s})}),a.length>0){let s=a.reduce((l,c)=>l+c.weight,0);if(s>0&&s/o*t>=i){let l={id:`combined-node-${Ye(s,a)}`,weight:s,isCombinedNode:!0,originalNodeCount:a.length,parent:null,groups:[],originalNodes:a};r.push(l)}}return r}function Xt(e,t,n,i=1){let o=[];if(!e.length)return o;let r=t.w*t.h,a=Math.min(t.w,t.h),s=Math.max(.5,Math.min(1,a/800)),c=Math.max(8,20/Math.sqrt(i)),u=c*c,h=n.rectGap*s,m=n.rectRadius*s,p=ze(e,r,c,u);if(!p.length)return o;let d=t;h>0&&(d={x:t.x+h/2,y:t.y+h/2,w:Math.max(0,t.w-h),h:Math.max(0,t.h-h)});let y=(g,f,v,I,M)=>{let N=p[g].weight*M,X=p[f].weight*M;return Math.max(v*v*N/(I*I),I*I/(v*v*X))};return((g,f,v=0)=>{let I=Math.max(.4,1-v*.15),M=h*I,N=m*I;for(;g<p.length;){let X=0;for(let E=g;E<p.length;E++)X+=p[E].weight;let H=Math.min(f.w,f.h),q=f.w*f.h/X,C=g,b=0,tt=0;for(;C<p.length;){let E=p[C].weight*q||0,ct=y(g,C,H,b+E,q);if(C>g&&tt<ct)break;b+=E,tt=ct,C++}let x=Math.round(b/H),et=0,Y=f.w>=f.h;for(let E=g;E<C;E++){let ct=E===g,Ce=E===C-1,z=p[E],Qt=z.weight*q,ut=Math.round(H*et/b),te=Math.round(H*(et+Qt)/b),nt,it,R,w;if(Y?(nt=f.x,it=f.y+ut,R=x,w=te-ut):(nt=f.x+ut,it=f.y,R=te-ut,w=x),M>0){let P=M/2;ct||(Y?(it+=P,w=Math.max(0,w-P)):(nt+=P,R=Math.max(0,R-P))),Ce||(Y?w=Math.max(0,w-P):R=Math.max(0,R-P))}let Re=_t(z)||1,{titleAreaHeight:Dt}=n,ee=Dt.max/Re,Tt=ee<Dt.min?Dt.min:ee;R=Math.max(1,R),w=Math.max(1,w);let ne=[];if(z.groups&&z.groups.length>0){let P=M>0?M:0,Ot={x:nt+P,y:it+Tt,w:Math.max(0,R-P*2),h:Math.max(0,w-Tt-P)},ie=N>0?N*2:1;Ot.w>=ie&&Ot.h>=ie&&(ne=Xt(z.groups||[],Ot,{...n,rectGap:M,rectRadius:N},i))}o.push({layout:[nt,it,R,w],node:z,children:ne,config:{titleAreaHeight:Tt,rectGap:M,rectRadius:N}}),et+=Qt}g=C;let L=M>0?M:0;Y?(f.x+=x+L,f.w=Math.max(0,f.w-x-L)):(f.y+=x+L,f.h=Math.max(0,f.h-x-L))}})(0,d),o}var Mt=class{plugins=new Map;pluginContext;constructor(t){this.pluginContext={resolveModuleById(n){return Ft(n,t.layoutNodes)},getPluginMetadata:n=>this.getPluginMetadata(n),get instance(){return t}}}use(t){if(!t.name){j.error("Plugin name is required");return}this.plugins.has(t.name)&&j.panic(`Plugin ${t.name} is already registered`),this.plugins.set(t.name,t)}runHook(t,...n){this.plugins.forEach(i=>{let o=i[t];o&&o.apply(this.pluginContext,n)})}cascadeHook(t,...n){let i={};return this.plugins.forEach(o=>{let r=o[t];if(r){let a=r.call(this.pluginContext,...n);a&&Object.assign(i,a)}}),i}getPluginMetadata(t){return this.plugins.get(t)?.meta||null}};var j=mt("Treemap"),We={mode:"rgb",desc:{r:0,g:0,b:0}},Ve={min:30,max:60},vt=4,Ke=4,$e={max:70,min:12},je="sans-serif",Ze="#000",bt=class extends ${pluginDriver;data;colorMappings;rectLayer;textLayer;layoutNodes;config;caches;constructor(t,...n){super(...n),this.data=[],this.config=t,this.colorMappings={},this.pluginDriver=new Mt(this),this.rectLayer=new B,this.textLayer=new B,this.caches=new ht(()=>14),this.layoutNodes=[]}clearFontCacheInAABB(t){let n=this.getModulesInAABB(this.layoutNodes,t);for(let i of n)this.caches.delete(i.node.id)}getModulesInAABB(t,n){let i=[];for(let o of t){let[r,a,s,l]=o.layout,c={x:r,y:a,width:s,height:l};this.isAABBIntersecting(c,n)&&(i.push(o),o.children&&o.children.length>0&&i.push(...this.getModulesInAABB(o.children,n)))}return i}getViewportAABB(t,n){let{width:i,height:o}=this.render.options,r=-t,a=-n;return{x:r,y:a,width:i,height:o}}getAABBUnion(t,n){let i=Math.min(t.x,n.x),o=Math.min(t.y,n.y),r=Math.max(t.x+t.width,n.x+n.width),a=Math.max(t.y+t.height,n.y+n.height);return{x:i,y:o,width:r-i,height:a-o}}handleTransformCacheInvalidation(t,n){let i=this.getViewportAABB(t.e,t.f),o=this.getViewportAABB(n.e,n.f),r=this.getAABBUnion(i,o);this.clearFontCacheInAABB(r)}isAABBIntersecting(t,n){return!(t.x+t.width<n.x||n.x+n.width<t.x||t.y+t.height<n.y||n.y+n.height<t.y)}drawBroundRect(t){let[n,i,o,r]=t.layout,{rectRadius:a}=t.config,s=Math.min(a,o/4,r/4),l=this.colorMappings[t.node.id]||We,c=dt(n,i,o,r,{fill:l,padding:0,radius:s});this.rectLayer.add(c);for(let u of t.children)this.drawBroundRect(u)}drawText(t){if(!t.node.label&&!t.node.isCombinedNode)return;let[n,i,o,r]=t.layout,{titleAreaHeight:a}=t.config,s=t.node.isCombinedNode?`+ ${t.node.originalNodeCount} Modules`:t.node.label,l=t.children&&t.children.length>0?a-vt*2:r-vt*2,c=o-vt*2;if(c<=0||l<=0)return;let u={fontSize:this.config.font?.fontSize||$e,family:this.config.font?.family||je,color:this.config.font?.color||Ze},m=`${this.caches.getOrInsert(t.node.id,Ue(this.render.ctx,s,u,c,l))}px ${u.family}`;this.render.ctx.font=m;let p=Je(this.render.ctx,s,c,l);if(!p.valid)return;let{text:d}=p,y=n+Math.round(o/2),O=i+(t.children&&t.children.length>0?Math.round(a/2):Math.round(r/2)),g=ce(d,y,O,m,u.color);this.textLayer.add(g);for(let f of t.children)this.drawText(f)}draw(t=!0,n=!0){let{width:i,height:o}=this.render.options;if(n&&(this.layoutNodes=this.calculateLayoutNodes(this.data,{w:i,h:o,x:0,y:0})),t){let r=this.pluginDriver.cascadeHook("onModuleInit",this.layoutNodes);r&&(this.colorMappings=r.colorMappings||{})}for(let r of this.layoutNodes)this.drawBroundRect(r);for(let r of this.layoutNodes)this.drawText(r);this.add(this.rectLayer,this.textLayer),n&&this.update()}cleanup(){this.remove(this.rectLayer,this.textLayer),this.rectLayer.destory(),this.textLayer.destory()}calculateLayoutNodes(t,n,i=1){let o={titleAreaHeight:this.config.layout?.titleAreaHeight??Ve,rectRadius:this.config.layout?.rectRadius??Ke,rectGap:this.config.layout?.rectGap??vt},r=Xt(t,n,o,i),a=this.pluginDriver.cascadeHook("onLayoutCalculated",r,n,o);return a&&a.layoutNodes?.length?a.layoutNodes:r}};function Ue(e,t,n,i,o){i=Math.floor(i),o=Math.floor(o);let{fontSize:r,family:a}=n,s=r.min,l=r.max;for(;l-s>=1;){let c=s+(l-s)/2;e.font=`${c}px ${a}`;let u=e.measureText(t).width,h=e.measureText(t),m=h.actualBoundingBoxAscent+h.actualBoundingBoxDescent;u<=i&&m<=o?s=c:l=c}return Math.floor(s)}function Je(e,t,n,i){let o=e.measureText(t).width,r=e.measureText(t);if(r.actualBoundingBoxAscent+r.actualBoundingBoxDescent>i)return{valid:!1,text:"",direction:"horizontal",width:0};if(o<=n)return{valid:!0,text:t,direction:"horizontal",width:o};let s=e.measureText("...").width;if(n<=s)return{valid:!1,text:"",direction:"horizontal",width:0};let l=0,c=t.length,u="";for(;l<=c;){let h=Math.floor((l+c)/2),m=t.substring(0,h);e.measureText(m).width+s<=n?(u=m,l=h+1):c=h-1}return u.length>0?{valid:!0,text:u+"...",direction:"horizontal",width:n}:{valid:!0,text:"...",direction:"horizontal",width:s}}var fe=["click","mousedown","mousemove","mouseup","mouseover","mouseout","wheel","contextmenu"],ge={IDLE:"IDLE",PRESSED:"PRESSED",DRAGGING:"DRAGGING",ZOOMING:"ZOOMING",MOVE:"MOVE",SCALING:"SCALING",PANNING:"PANNING"},qt=class{current;constructor(){this.current=ge.IDLE}canTransition(t){switch(this.current){case"IDLE":return t==="PRESSED"||t==="MOVE"||t==="SCALING"||t==="ZOOMING"||t==="PANNING";case"PRESSED":return t==="DRAGGING"||t==="IDLE";case"DRAGGING":return t==="IDLE";case"MOVE":return t==="PRESSED"||t==="IDLE";case"SCALING":return t==="IDLE";case"ZOOMING":return t==="IDLE";case"PANNING":return t==="IDLE";default:return!1}}transition(t){let n=this.canTransition(t);return n&&(this.current=t),n}reset(){this.current=ge.IDLE}isInState(t){return this.current===t}};function Yt(e){return e.kind==="wheel"}function zt(e){return e.kind==="contextmenu"}function Qe(e,t,n){let i=o=>{let r={native:o};Object.defineProperty(r,"kind",{value:t,enumerable:!0,configurable:!1,writable:!1}),n.emit(t,r)};return e.addEventListener(t,i),{evt:t,handler:i}}var Et=class extends G{domEvents;el;currentModule;component;matrix;stateManager;constructor(t){super(),this.component=t,this.el=t.render.canvas,this.matrix=new W,this.currentModule=null,this.stateManager=new qt,this.domEvents=fe.map(n=>Qe(this.el,n,this)),fe.forEach(n=>{this.on(n,i=>{this.dispatch(n,i)})})}destory(){if(this.el){this.domEvents.forEach(({evt:t,handler:n})=>this.el?.removeEventListener(t,n)),this.domEvents=[];for(let t in this.eventCollections)this.off(t);this.matrix.create(k)}}dispatch(t,n){let i=this.findRelativeNode(n);this.component.pluginDriver.runHook("onDOMEventTriggered",t,n,i,this),this.emit("__exposed__",t,{native:n.native,module:i})}findRelativeNode(t){return Ht(ae(this.el,t.native,1,1,this.matrix.e,this.matrix.f),this.component.layoutNodes)}};function ye(e){let{plugins:t=[],graphic:n={}}=e||{},i=null,o=!1,r=null,a=null,s=new G;Array.isArray(t)||j.panic("Plugins should be an array");let l={init:c,dispose:u,resize:h,setOptions:m};function c(d){a=new bt(n,d),r=new Et(a),i=d,i.style.position="relative",o||(t.forEach(y=>a?.pluginDriver.use(y)),o=!0,a.pluginDriver.runHook("onLoad",l,r)),r.on("__exposed__",(y,O)=>s.emit(y,O))}function u(){if(i&&a&&r){r.destory(),a.destory(),i.removeChild(i.firstChild);for(let d in s.eventCollections)s.off(d);a.pluginDriver.runHook("onDispose"),i=null,a=null,r=null}}function h(){if(!a||!i)return;let{width:d,height:y}=i.getBoundingClientRect();a.render.initOptions({height:y,width:d,devicePixelRatio:window.devicePixelRatio}),a.render.canvas.style.position="absolute",r&&a.pluginDriver.runHook("onResize",r),a.cleanup(),a.draw()}function m(d){de(a,j,"Treemap not initialized. Please call `init()` before setOptions."),a.data=Gt(d.data),h()}return pt(l,[{name:"on",fn:()=>s.on.bind(s)},{name:"off",fn:()=>s.off.bind(s)}])}var Wt=class extends ${reset(){this.destory(),this.update()}get canvas(){return this.render.canvas}setZIndexForHighlight(t="-1"){this.canvas.style.zIndex=t}init(){this.setZIndexForHighlight(),this.canvas.style.position="absolute",this.canvas.style.pointerEvents="none"}},F=300,tn=.3,en={desc:{r:255,g:255,b:255},mode:"rgb"},Vt={name:"treemap:preset-highlight",onLoad(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&(e.highlight||(e.highlight=new Wt(this.instance.to)))},onDOMEventTriggered(e,t,n,{stateManager:i,matrix:o}){if(e==="mousemove"&&i.canTransition("MOVE")){let r=this.getPluginMetadata("treemap:preset-highlight");if(!n){r.highlight?.reset(),r.highlight?.update(),r.highlight?.setZIndexForHighlight(),r.highlightSeq=(r.highlightSeq??0)+1;return}let[a,s,l,c]=n.layout,u=Math.min(n.config.rectRadius,l/4,c/4);r.highlightSeq=(r.highlightSeq??0)+1;let h=r.highlightSeq;_((m,p)=>{if(r.highlightSeq!==h){r.highlight?.setZIndexForHighlight(),p();return}p(),r.highlight?.reset();let d=dt(a,s,l,c,{fill:en,opacity:tn,radius:u,padding:0});r.highlight?.add(d),r.highlight?.setZIndexForHighlight("1"),kt(d,o.e,o.f,1),r.highlight?.update()},{duration:F})}},onResize(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&(e.highlight?.render.initOptions({...this.instance.render.options}),e.highlight?.reset(),e.highlight?.init())},onDispose(){let e=this.getPluginMetadata("treemap:preset-highlight");e&&e.highlight&&(e.highlight.destory(),e.highlight=null)},meta:{highlight:null,highlightSeq:0}};var Kt={name:"treemap:preset-drag-element",onDOMEventTriggered(e,t,n,i){let{stateManager:o,matrix:r,component:a}=i;switch(e){case"mousemove":{o.isInState("DRAGGING")?i.silent("click"):i.active("click");let s=U.call(this);if(!s)return;if(s.dragOptions.x===0&&s.dragOptions.y===0){o.transition("IDLE");return}if(o.transition("DRAGGING"),o.isInState("DRAGGING")){let l=J.call(this);_((c,u)=>{u();let{offsetX:h,offsetY:m}=t.native,p=h-s.dragOptions.x,d=m-s.dragOptions.y,y=s.dragOptions.x,O=s.dragOptions.y;return l?.highlight&&(l.highlight.reset(),l.highlight.setZIndexForHighlight()),r.translation(p,d),s.dragOptions.x=h,s.dragOptions.y=m,s.dragOptions.lastX=y,s.dragOptions.lastY=O,a.cleanup(),a.draw(!1,!1),K(a.elements,r.e,r.f,1),a.update(),!0},{duration:F,deps:[()=>o.isInState("IDLE")]})}break}case"mouseup":{if(o.isInState("PRESSED")){let s=U.call(this);if(s&&s.dragOptions&&s.dragOptions.x===s.dragOptions.lastX&&s.dragOptions.y===s.dragOptions.lastY){o.transition("IDLE");return}}if(o.isInState("DRAGGING")&&o.canTransition("IDLE")){let s=J.call(this);s&&s.highlight&&(s.highlight.reset(),s.highlight.setZIndexForHighlight());let l=U.call(this);l&&l.dragOptions&&(l.dragOptions.x=0,l.dragOptions.y=0,l.dragOptions.lastX=0,l.dragOptions.lastY=0,o.transition("IDLE"))}break}case"mousedown":{if(he(t.native))return;let s=U.call(this);if(!s)return;s.dragOptions.x=t.native.offsetX,s.dragOptions.y=t.native.offsetY,s.dragOptions.lastX=t.native.offsetX,s.dragOptions.lastY=t.native.offsetY,o.transition("PRESSED");break}}},meta:{dragOptions:{x:0,y:0,lastX:0,lastY:0}},onResize({matrix:e,stateManager:t}){e.create(k),t.reset()}};function J(){return this.getPluginMetadata("treemap:preset-highlight")}function U(){return this.getPluginMetadata("treemap:preset-drag-element")}function $t(e){let t=null,n=null,i=o=>{if(!n||!t)return;let r=o.target;if(r.parentNode){let s=r.parentNode.getAttribute("data-action");if(!s)return;e?.onClick&&e.onClick(s,n.findRelativeNode({native:o,kind:void 0}))}t.style.display="none"};return{name:"treemap:preset-menu",onDOMEventTriggered(o,r,a,s){if(zt(r)){if(r.native.stopPropagation(),r.native.preventDefault(),!t){if(t=document.createElement("div"),n=s,Object.assign(t.style,{backgroundColor:"#fff",...e?.style,position:"absolute",zIndex:"9999"}),t.addEventListener("click",i),t&&e?.render){let l=e.render(t);t.innerHTML=l.map(c=>`<div data-action='${c.action}'>${c.html}</div>`).join("")}document.body.append(t)}t.style.left=r.native.clientX+"px",t.style.top=r.native.clientY+"px",t.style.display="initial"}},onDispose(){t&&(t.removeEventListener("click",i),t=null,n=null)}}}var jt={name:"treemap:preset-color",onModuleInit(e){let t={};for(let n=0;n<e.length;n++){let i=e[n];xe(t,i,Math.abs(at(i.node.id))%oe,0)}return{colorMappings:t}}};function xe(e,t,n,i){let o=Math.abs(at(t.node.id))%60-30,r=(n+o)%360,a=Math.max(75-i*5,40),s=55-i*3,l=nn(r,a,s);if(e[t.node.id]=l,t.node.isCombinedNode&&t.node.originalNodes)for(let c of t.node.originalNodes)e[c.id]=l;if(t.children&&t.children.length){let c=t.children.length;for(let u=0;u<c;u++){let h=40*u/c,m=(r+h)%360;xe(e,t.children[u],m,i+1)}}}function nn(e,t,n){return e=(e%360+360)%360,t=Math.min(Math.max(t,40),85),n=Math.min(Math.max(n,35),75),e>=60&&e<=180?(t=Math.max(t-10,40),n=Math.min(n+5,75)):e>=200&&e<=280?n=Math.min(n+8,75):e>=0&&e<=30&&(t=Math.max(t-5,40)),{mode:"hsl",desc:{h:e,s:t,l:n}}}function Zt(e){return{name:"treemap:preset-scale",onDOMEventTriggered(t,n,i,o){Yt(n)&&rn(this,n,o)},meta:{scaleOptions:{scale:1,minScale:e?.min||.1,maxScale:e?.max||1/0,scaleFactor:.05},gestureState:{isTrackingGesture:!1,lastEventTime:0,eventCount:0,totalDeltaY:0,totalDeltaX:0,consecutivePinchEvents:0,gestureType:"unknown",lockGestureType:!1}},onResize({matrix:t,stateManager:n}){let i=lt.call(this);i&&(i.scaleOptions.scale=1),t.create(k),n.reset()}}}function lt(){return this.getPluginMetadata("treemap:preset-scale")}function on(e,t){let n=Date.now();if(n-t.lastEventTime>150?Object.assign(t,{isTrackingGesture:!1,lastEventTime:n,eventCount:1,totalDeltaY:Math.abs(e.deltaY),totalDeltaX:Math.abs(e.deltaX),consecutivePinchEvents:0,gestureType:"unknown",lockGestureType:!1}):(t.eventCount++,t.totalDeltaY+=Math.abs(e.deltaY),t.totalDeltaX+=Math.abs(e.deltaX),t.lastEventTime=n),e.ctrlKey||Math.abs(e.deltaX)>=100&&Math.abs(e.deltaX)<=10||Math.abs(e.deltaY)>50&&Math.abs(e.deltaX)<Math.abs(e.deltaY)*.1)return t.gestureType="zoom",t.lockGestureType=!0,"zoom";if(t.lockGestureType&&t.gestureType!=="unknown")return t.gestureType;if(t.eventCount>=3){let r=t.totalDeltaY/t.eventCount,s=t.totalDeltaX/t.eventCount/(r+.1);return r>8&&s<.3&&Math.abs(e.deltaY)>5?(t.gestureType="zoom",t.lockGestureType=!0,"zoom"):(t.gestureType="pan",t.lockGestureType=!0,"pan")}return"pan"}function rn(e,t,n){t.native.preventDefault();let i=lt.call(e);if(!i)return;on(t.native,i.gestureState)==="zoom"?sn(e,t,n):an(e,t,n)}function Me(e,{stateManager:t,component:n,matrix:i},o=!1){let r=J.apply(e),a=()=>{r&&r.highlight&&(r.highlight.reset(),r.highlight.setZIndexForHighlight()),r&&(r.highlightSeq=(r.highlightSeq??0)+1),n.cleanup();let{width:s,height:l}=n.render.options;n.layoutNodes=n.calculateLayoutNodes(n.data,{w:s*i.a,h:l*i.d,x:0,y:0},1),n.draw(!0,!1),K(n.elements,i.e,i.f,1),n.update(),t.canTransition("IDLE")&&t.transition("IDLE")};o?_((s,l)=>(l(),a(),!0),{duration:F}):a()}function sn(e,t,n){let{stateManager:i,matrix:o,component:r}=n,a=lt.call(e);if(!a)return;let{scale:s,minScale:l,maxScale:c,scaleFactor:u}=a.scaleOptions,h={e:o.e,f:o.f},m=Math.max(u,s*.1),p=t.native.deltaY<0?m:-m,d=Math.max(l,Math.min(c,s+p));if(d===s)return;i.transition("SCALING");let y=t.native.offsetX,O=t.native.offsetY,g=d/s;a.scaleOptions.scale=d,o.scale(g,g),o.e=y-(y-o.e)*g,o.f=O-(O-o.f)*g;let f={e:o.e,f:o.f};r.handleTransformCacheInvalidation(h,f),Me(e,n,!1)}function an(e,t,n){let{stateManager:i,matrix:o}=n,r=.8,a=t.native.deltaX*r,s=t.native.deltaY*r;i.transition("PANNING"),o.e-=a,o.f-=s,Me(e,n,!0)}var ln=2,ve=.85,Ut={name:"treemap:preset-zoomable",onLoad(e,{stateManager:t,matrix:n}){return pt(e,[{name:"zoom",fn:()=>i=>{let o=this.getPluginMetadata("treemap:preset-zoomable");if(!o||t.isInState("ZOOMING"))return;let r=this.resolveModuleById(i);if(!r)return;let a={e:n.e,f:n.f,a:n.a};o.previousMatrixState={e:n.e,f:n.f,a:n.a,d:n.d};let s=this.instance;t.transition("ZOOMING");let[l,c,u,h]=r.layout,{width:m,height:p}=s.render.options,d=n.a,y=m*ve/u,O=p*ve/h,g=Math.min(y,O),f=d*ln,v=Math.max(d,Math.min(g,f)),I=m/2,M=p/2,N=(l+u/2)/d,X=(c+h/2)/d,H=I-N*v,q=M-X*v,C=lt.call(this);C&&(C.scaleOptions.scale=v);let b=J.call(this),tt=U.call(this);tt&&Object.assign(tt.dragOptions,{x:0,y:0,lastX:0,lastY:0});let x={e:n.e,f:n.f,a:n.a,d:n.d},et={e:H,f:q};s.handleTransformCacheInvalidation(a,et),_(Y=>{let L=se.cubicInOut(Y);n.create(k),n.e=x.e+(H-x.e)*L,n.f=x.f+(q-x.f)*L,n.a=x.a+(v-x.a)*L,n.d=x.d+(v-x.d)*L,b?.highlight&&(b.highlight.reset(),b.highlight.setZIndexForHighlight()),b&&(b.highlightSeq=(b.highlightSeq??0)+1),s.cleanup(),s.layoutNodes=s.calculateLayoutNodes(s.data,{w:m*n.a,h:p*n.d,x:0,y:0},1),s.draw(!0,!1),K(s.elements,n.e,n.f,1),s.update()},{duration:F,onStop:()=>{t.reset()}})}}])},meta:{isZooming:!1}};var De=document.querySelector("#app"),Q=ye({plugins:[jt,Ut,Vt,Kt,Zt(),$t({style:{borderRadius:"5px",padding:"6px 3px",boxSizing:"border-box",cursor:"pointer",width:"120px",textAlign:"center",userSelect:"none"},render:()=>[{html:"<p>Zoom</p>",action:"zoom"},{html:"<p>Reset</p>",action:"reset"}],onClick(e,t){switch(e){case"zoom":{t?.node.id&&Q.zoom(t.node.id);break}case"reset":Q.resize()}}})]});function cn(){return fetch("data.json").then(e=>e.json()).then(e=>e)}function Te(e){let t={...e};return e.children&&(t.groups=e.children.map(Te)),t}async function un(){let t=(await cn()).map(Te),n=gt(t.map(i=>yt(i,"value",o=>({...o,id:o.path,label:o.name}))),"weight");Q.setOptions({data:n})}Q.init(De);Q.on("click",function(){});un().catch(console.error);new ResizeObserver(()=>Q.resize()).observe(De);var T=document.createElement("div");T.style.position="fixed";T.style.left="20px";T.style.bottom="20px";T.style.padding="10px";T.style.backgroundColor="rgba(0, 0, 0, 0.7)";T.style.color="white";T.style.borderRadius="5px";T.style.fontFamily="Arial, sans-serif";T.style.fontSize="14px";T.textContent="FPS: 0";document.body.appendChild(T);var be=0,Jt=0,Ee=0;function Oe(e){if(be!==0&&(Jt++,e-Ee>=1e3)){let t=Jt;T.textContent=`FPS: ${t}`,Jt=0,Ee=e}be=e,requestAnimationFrame(Oe)}requestAnimationFrame(Oe);})();
</script>  </body>
</html>
